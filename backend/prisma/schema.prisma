generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  auth0Id   String   @unique @map("auth0_id")
  email     String   @unique
  username  String?  @unique
  avatarUrl String?  @map("avatar_url")

  reviews MovieReview[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("users")
}

model Movie {
  id           Int       @id // TMDB movie ID — no auto-increment
  title        String
  overview     String
  posterPath   String?   @map("poster_path")
  backdropPath String?   @map("backdrop_path")
  releaseDate  DateTime? @map("release_date")
  voteAverage  Float     @default(0) @map("vote_average")
  popularity   Float     @default(0)
  genres       String[]

  reviews MovieReview[]

  syncedAt DateTime @default(now()) @map("synced_at")

  @@map("movies")
}

model MovieReview {
  id      String  @id @default(uuid())
  rating  Int // 1–10
  content String?

  user   User   @relation(fields: [userId], references: [id])
  userId String @map("user_id")

  movie   Movie @relation(fields: [movieId], references: [id])
  movieId Int   @map("movie_id")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@unique([userId, movieId]) // one review per user per movie
  @@map("movie_reviews")
}
